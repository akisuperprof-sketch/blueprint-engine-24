# 更新履歴 (Changelog)

このファイルは「ブループリントエンジン24 (Blueprint Engine)」プロジェクトの更新履歴を記録します。

## 2026-01-05

### 02:30 - 基本モデルの刷新
*   **Update:** ユーザー要望に基づき、デフォルトの使用モデルを変更。
    *   **Text (構造化):** `Gemini 3 Flash` を最優先に設定。
    *   **Image (生成):** `Nano Banana Pro (Gemini 3 Pro Image Preview)` を最優先に設定。
*   **UI:** AI処理中のローディングメッセージを、新モデル名 (`Gemini 3 Flash`) に合わせて更新。

## 2025-12-25

### 09:00 - 画像生成モデルの仕様明確化
*   **Update:** 画像生成の優先モデルを `imagen-3.0-generate-001` に明示的に変更し、スペックシートに反映。
*   **Fallback:** フォールバックチェーンを見直し、`imagen-3.0` -> `gemini-3-pro` -> `nano-banana` -> `gemini-2.0-flash` の順序を確立。

## 2025-12-23

### 16:00 - Phase 6: 納品品質の追求（文字なし素材＆画質限界突破）
*   **Feature (Pro-Material):** 「文字なし背景素材（納品用素材）」作成機能を追加。AIに元のレイアウトを「トレース」させつつ、テキストだけを「コンテンツに応じた塗りつぶし」で消去させる高度なプロンプトを実装。プロの納品ワークフローに対応。
*   **Feature (Ultra-Resolution):** 
    *   UIに「高精細モード (SVG優先)」トグルを搭載。ボケのないベクター画像の生成を優先する設定を追加。
    *   Canvasエクスポートを「最高品質PNG (Quality 1.0)」に改善し、保存時の画質劣化を排除。
*   **System (Model Switching):** 文字消し等の特殊タスクにおいて、指示への忠実度が高い `gemini-1.5-pro-002` へ動的に切り替えるインテリジェント・エンジンを搭載。
*   **Prompt:** プロンプト密度を8k解像度相当へ引き上げ。

### 10:30 - Phase 5: プロフェッショナル品質への進化とモバイル最適化
*   **Feature (Rich Mode):** ドラフト（下書き）の書き込み量を選択できる「Richness」機能を追加。「リッチ」モードのAIプロンプトを刷新し、ハッチング・モーションライン・極太矢印を含む「商業用絵コンテ」レベルの高品質な下書き生成を実現。
*   **UI (Mobile):** スマートフォンでの表示を最適化。
    *   タイトル文字サイズのレスポンシブ調整。
    *   スタイル選択・リッチ度選択・アスペクト比選択のグリッドを、スマホ画面では2列表示に変更し操作性を向上。
    *   履歴・設定モーダルの幅をスマホ画面に合わせて自動調整。
*   **Fix:** 画像生成APIにおけるアスペクト比指定のエラーを修正（Config指定からプロンプト指示へ変更）。
*   **System:** 清書（Step 4）時に、ドラフト画像をリファレンスとして送信する機能を復活させ、構図の忠実度を大幅に向上。

### 10:00 - UI/UXの最適化と機能改善
*   **UI (Step 1):** 画像サイズ（アスペクト比）の選択ボタンを、設定メニュー内から「構造化を開始する」ボタンの直上に移動。生成直前の最終確認として機能するように配置を最適化。
*   **UI (Step 2):** 構成編集画面において、「Header Area」「Footer Area」のデザインを他のブロック要素と統一（白カード＋バッジスタイル）。
*   **Feature:** ヘッダー・フッターに削除機能を追加。不要なセクションをワンクリックで除外可能に。

## 2025-12-12

### 09:00 - UIデザイン刷新 (Light Mode Blueprint) & ロゴ統合
*   **Design**: アプリ全体のUIテーマを「Light Mode Blueprint」に刷新。
    *   背景をホワイト（#F8FAFC）基調に変更し、淡いブルーのグリッドパターン（設計図風）を採用。
    *   アクセントカラーに鮮やかなロイヤルブルー（#2563EB）を使用し、先進的かつクリアな印象に。
    *   文字色をダークグレー（#0F172A）系に統一し、視認性を向上。
    *   スタイル選択カード等のコンポーネントもLight Modeに合わせて配色を調整。
*   **Asset**: ヘッダーに「Blueprint Engine」ロゴ画像 (`logo.png`) を統合。

## 2025-12-11

### 23:00 - リブランディング (Blueprint Engine 24)
*   **Rebrand**: アプリ名を「スキームメーカー」から「ブループリントエンジン24 (Blueprint Engine 24)」へ変更。
*   **Design**: ブランドカラーをDeep Blue基調に変更。
*   **Concept**: コンセプトを「思考の構造化エンジン」として再定義し、トップページのメッセージを刷新。

### 21:00 - 機能強化とUIローカライズ
*   **Feature (Image)**: リファレンス画像のアップロード機能を追加。キャラクターや特定スタイルの「必須」指定が可能になり、Step 3/4の生成に強く反映されるよう改修。
*   **Feature (History)**: 履歴管理機能 (`history_utils.py`) を実装。生成完了時の自動保存と、ヘッダーの「🕒」アイコンからのセッション復元が可能に。
*   **Feature (Refine)**: Step 4 に微調整（Refinement）機能を追加。生成画像に対して自然言語で修正指示が出せるワークフローを追加。
*   **UI/UX**: Streamlit標準のヘッダー・フッター・Deployボタンを非表示化し、アプリ独自のヘッダーに整理。
*   **L10n**: 設定メニューやUIテキストを完全に日本語化。

## 2025-12-10

### 16:00 - UIの大幅刷新とエラー修正
*   **Fix**: Step 1での `SyntaxError: invalid character` (全角文字混入) を修正し、ホワイトスクリーン問題を解決。
*   **Design**: アプリ全体のマージンやパディングを微調整し、クリーンな表示に修正。

### 15:55 - レガシーUIの一掃とブランド変更
*   **Rename**: アプリ名を「わど図解」から「スキームメーカー」へ変更（法務リスク対応）。タイトルタグとヘッダー表示を統一。
*   **Design**: プログレスバーのデザインを完全に刷新。点線テキストから、ウィザード形式のモダンなステップ表示に変更。HTML/CSSの実装を改善し、コードブロックとして誤表示されるバグを修正。

### 15:40 - Recraft風UIの導入 (設定・スタイル選択)
*   **UI/UX**: 左サイドバーの設定メニューを廃止し、画面右上の「⚙️ 設定」ポップオーバーメニューに統合。画面を広く使えるように変更。
*   **Feature**: Step 4（デザイン選択）のUIを、従来のプルダウンリストから「カード型グリッド選択」に変更。Recraftを模した直感的なビジュアル選択が可能に。
*   **System**: セッション管理（API Key, モデル設定）のロジックをリファクタリングし、設定変更時の挙動を安定化。

### 15:20 - モデル・機能の最適化
*   **System**: `generate_with_fallback` 関数の定義位置を修正し、`NameError` を解消。
*   **Model**: Gemini 2.5 / 3.0系モデルに加え、画像生成モデル `nano-banana-pro-preview` への対応を強化。
*   **Feature**: 履歴クリア（リセット）ボタンの実装。

### 14:00 - プロジェクト初期化・基盤構築
*   **Init**: Streamlitアプリケーションの基盤構築。
*   **Feature**: テキスト分析によるJSON構造化、ドラフト生成、最終画像生成の4ステップフローを実装。
